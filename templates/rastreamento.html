
{% extends "templates/base.html" %}


{%block title%}Infotrack - Rastreamento Veicular {% endblock %}

{% block head %}

<link rel="stylesheet" type="text/css" media="screen" href="/media/css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/media/css/jquery-ui-1.8.12.custom.css" />

<script src="/media/js/i18n/grid.locale-en.js" type="text/javascript"></script>
<script src="/media/js/jquery.jqGrid.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="http://www.geoportal.com.br/Api_Js_v3/v3.js"></script>
<script type="text/javascript" src="http://187.115.25.240:8088/media/js/multispetral.js"></script>


<script type="text/javascript">

$('#tabs-1"').ready(function(){  
  montartabela();
});

function montartabela(h,w) {
  
  /* ----------- JQGRID READY ----------- */ 

  var mydata = [ {id:"1",invdate:"2007-10-01",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"} ];

  for(var i=2;i<=50;i++) {
  	mydata[i] = [ {id:i,invdate:"2007-10-01",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"} ];
  }
  
  if (h == null && w == null) {

  w = screen.availWidth;
  h = screen.availHeight;
  
  jQuery("#list4").jqGrid({ 

  	datatype: "local",
  	height:h-500,
  	width: 930,
  	colNames:[
  	'Veículo',
  	'Modelo'
  	], 
  	colModel:[ 
  	{name:'id',index:'id', sorttype:"int"}, 
  	{name:'invdate',index:'invdate', sorttype:"date"}
  	], 
  	multiselect: true, 
  	caption: "Rastreamento veicular" }); 

  	for(var i=0;i<=mydata.length;i++) {
  		jQuery("#list4").jqGrid('addRowData',i+1,mydata[i]); 
  	}
  	
  }
  
  else {

    
    w = screen.availWidth;
    h = screen.availHeight;
    
    jQuery("#list5").jqGrid({ 
    	datatype: "local",
    	height:h - 250,
    	width: w - 50,
    	colNames:[
    	'Veículo',
    	'Modelo'
    	], 
    	colModel:[ 
    	{name:'id',index:'id', sorttype:"int"}, 
    	{name:'invdate',index:'invdate', sorttype:"date"}
    	], 
    	multiselect: true, 
    	caption: "Rastreamento veicular" }); 

    	for(var i=0;i<=mydata.length;i++) {
    		jQuery("#list4").jqGrid('addRowData',i+1,mydata[i]); 
    	}
    
  }

  /* --------- FIM JQGRID READY --------- */
  
  
}


jQuery(document).ready(function(){  
  w = screen.availWidth;
  h = screen.availHeight;  

  //$( "#tabs" ).css("height",h - (0.36 * h));
  $( "#tabs" ).css("top","170px");
  
  document.body.style.overflow = "hidden";
  
  normal = 1;
  $('.fullscreen').click(function() {
    
    if (normal == 1) {
    
    width = $('#tabs').css("width");
    height= $('#tabs').css("height");
    height = $('#tabs').css("height");
    top =  parseInt($('#tabs').position().top);
    left =  $('#tabs').css("left");
    top = parseInt(top);
    alert (top);
    }
    
    normal = 0;
    
    $('#menuContainer').css("z-index","0");
    $('#tabs').css("width","100%");
    $('#tabs').css("height","100%");
    $('#tabs').css("top","0");
    $('#tabs').css("left","0");
  });
  
  $('.normal').click(function() {
    normal = 1;
    $('#menuContainer').css("z-index","2");
    $('#tabs').css("width","960px");
    $('#tabs').css("height",height);
    $('#tabs').css("top","170px" );
    $('#tabs').css("left",( left ) );
    alert ($('#tabs').css("top"));
  });

});
/* --------- GOOGLE MAPS--------- */

var geocoder;
var map;
var infowindow = new google.maps.InfoWindow();
var marker;
geocoder = new google.maps.Geocoder();

function codeLatLng() {
  
	var geocoder;
	var map;
	var infowindow = new google.maps.InfoWindow();
	var marker;
	geocoder = new google.maps.Geocoder();
	var latlng = new google.maps.LatLng(-14.239424,-53.186502);
	var myOptions = {
		zoom: 4,
		center: latlng,
		mapTypeId: 'roadmap'
	}
	map = new google.maps.Map(document.getElementById("tabs-3"), myOptions);
  
	var input = "-22.896359,-47.060092";
	var latlngStr = input.split(",",2); 
	var lat = parseFloat(latlngStr[0]);
	var lng = parseFloat(latlngStr[1]);
	var latlng = new google.maps.LatLng(lat, lng);
	geocoder.geocode({'latLng': latlng}, function(results, status) {
		if (status == google.maps.GeocoderStatus.OK) {
			if (results[1]) {
				map.setZoom(16);
				marker = new google.maps.Marker({
					position: latlng, 
					map: map
				});
				infowindow.setContent(results[1].formatted_address);
				infowindow.open(map, marker);
			} else {
				alert("No results found");
			}
		} else {
			alert("Geocoder failed due to: " + status);
		}
	});
  
  //document.getElementById('pop').style.display='block';

	//$("#dialog").dialog({height: $(window).height()},{ width : ($(window).width() - 25)},{ closeText: 'X' }); 
	$(".ui-icon").css("background-image", "none");
	$(".ui-icon").css("text-indent", "0");
}

function mapa_multi() {
	callMultispectral(-22.896359,-47.060092);
	//jQuery("#dialog").dialog({height: $(window).height()},{ width : ($(window).width() - 25)},{ closeText: 'X' }); 
	//jQuery(".ui-icon").css("background-image", "none");
	//jQuery(".ui-icon").css("text-indent", "0");
	
}

</script>

<script>
	$(function() {
		$( "#tabs" ).tabs();
		$( ".tabs-bottom .ui-tabs-nav, .tabs-bottom .ui-tabs-nav > *" )
			.removeClass( "ui-corner-all ui-corner-top" )
			.addClass( "ui-corner-bottom" );
	});
	
	w = screen.availWidth;
  h = screen.availHeight;
  
  
	
	</script>
	
	
	
	
	<style>
	#tabs { bottom:0;position: fixed; width:960px;z-index:0;} 
	.tabs-bottom { position: relative; } 
	.tabs-bottom .ui-tabs-panel { height: 100%; overflow: hidden; left:0;} 
	.tabs-bottom .ui-tabs-nav { position: absolute !important; left: 0; bottom: 0; right:0; padding: 0 0.2em 0.2em 0; } 
	.tabs-bottom .ui-tabs-nav li { margin-top: -2px !important; margin-bottom: 1px !important; border-top: none; border-bottom-width: 1px; }
	.ui-tabs-selected { margin-top: -3px !important; }
	</style>

{% endblock %}

{% block content %}



{% endblock %}

{% block toolbar %}
<div id="tabs" class="tabs-bottom">
	<ul>
		<li><a class="normal" href="#tabs-1">Grid</a></li>
		<li><a onClick="montartabela(1,2)"  class="fullscreen" href="#tabs-2">Grid tela cheia</a></li>
		{%if map_google %}<li><a class="fullscreen" href="#tabs-3" onClick="codeLatLng();">Google</a></li>{% endif %}
		{%if map_multispectral %}<li><a class="fullscreen" href="#" onClick="">Multispectral</a></li>{% endif %}
		{%if map_maplink %}<li><a class="fullscreen" href="#" onClick="">Maplink</a></li>{% endif %}
		
		
	</ul>
	<div id="tabs-1">
	<table id="list4"></table> 
	</div>
  <div id="tabs-2" style="z-index:-1">
  <table id="list5"></table> 
	</div>
	<div id="tabs-3" style="z-index:-1">

	</div>
	<div id="tabs-4">

	</div>
</div>



{% endblock %}

{% block dialogMap %}
<div id="dialog" title="Rastreamento Veicular">

</div>
{% endblock %}
