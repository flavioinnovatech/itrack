{% extends "templates/base.html" %}
{% block title %} Rastreamento Veicular {% endblock %}

{% block head %}

<link rel="stylesheet" type="text/css" media="screen" href="/media/css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/media/css/jquery-ui-1.8.12.custom.css" />

<script src="/media/js/i18n/grid.locale-en.js" type="text/javascript"></script>
<script src="/media/js/jquery.jqGrid.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="http://www.geoportal.com.br/Api_Js_v3/v3.js"></script>
<script type="text/javascript" src="http://187.115.25.240:8088/media/js/multispetral.js"></script>


<script type="text/javascript">
jQuery(document).ready(function(){ 

/* ----------- JQGRID READY ----------- */ 

var mydata = [ {id:"1",invdate:"2007-10-01",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"} ];

for(var i=2;i<=50;i++) {
	mydata[i] = [ {id:i,invdate:"2007-10-01",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"} ];
}

var h = 25 + 5 * mydata.length;
var h = 280;

jQuery("#list4").jqGrid({ 
	datatype: "local",
	height:h,
	width: 960,
	colNames:[
	'Veículo',
	'Modelo', 
	'Placa', 
	'Km/h',
	'Data',
	'Endereço',
	'Cidade',
	'UF',
	'Ignição',
	'Status Motor',
	'GPS',
	'Pânico',
	'Bateria'
	], 
	colModel:[ 
	{name:'id',index:'id', sorttype:"int"}, 
	{name:'invdate',index:'invdate', sorttype:"date"},
	{name:'name',index:'name'},
	{name:'amount',index:'amount', align:"center",sorttype:"float"}, 
	{name:'tax',index:'tax', align:"center",sorttype:"float"},
	{name:'total',index:'total',align:"center",sorttype:"float"},
	{name:'note',index:'note',sortable:false},
	{name:'note',index:'note',sortable:false},
	{name:'note',index:'note',sortable:false},
	{name:'note',index:'note',sortable:false},
	{name:'note',index:'note',sortable:false},
	{name:'note',index:'note',sortable:false},
	{name:'note',index:'note',sortable:false}
	], 
	multiselect: true, 
	caption: "Rastreamento veicular" }); 

	for(var i=0;i<=mydata.length;i++) {
		jQuery("#list4").jqGrid('addRowData',i+1,mydata[i]); 
	}

/* --------- FIM JQGRID READY --------- */

/* --------- MULTISPECTRAL READY --------- */

});

/* --------- GOOGLE MAPS--------- */

var geocoder;
var map;
var infowindow = new google.maps.InfoWindow();
var marker;
geocoder = new google.maps.Geocoder();

function codeLatLng() {
	var geocoder;
	var map;
	var infowindow = new google.maps.InfoWindow();
	var marker;
	geocoder = new google.maps.Geocoder();
	var latlng = new google.maps.LatLng(-14.239424,-53.186502);
	var myOptions = {
		zoom: 4,
		center: latlng,
		mapTypeId: 'roadmap'
	}
	map = new google.maps.Map(document.getElementById("pop"), myOptions);

	var input = "-22.896359,-47.060092";
	var latlngStr = input.split(",",2); 
	var lat = parseFloat(latlngStr[0]);
	var lng = parseFloat(latlngStr[1]);
	var latlng = new google.maps.LatLng(lat, lng);
	geocoder.geocode({'latLng': latlng}, function(results, status) {
		if (status == google.maps.GeocoderStatus.OK) {
			if (results[1]) {
				map.setZoom(16);
				marker = new google.maps.Marker({
					position: latlng, 
					map: map
				});
				infowindow.setContent(results[1].formatted_address);
				infowindow.open(map, marker);
			} else {
				alert("No results found");
			}
		} else {
			alert("Geocoder failed due to: " + status);
		}
	});
  
  document.getElementById('pop').style.display='block';

	//$("#dialog").dialog({height: $(window).height()},{ width : ($(window).width() - 25)},{ closeText: 'X' }); 
	$(".ui-icon").css("background-image", "none");
	$(".ui-icon").css("text-indent", "0");
}

function mapa_multi() {
	callMultispectral(-22.896359,-47.060092);
	//jQuery("#dialog").dialog({height: $(window).height()},{ width : ($(window).width() - 25)},{ closeText: 'X' }); 
	//jQuery(".ui-icon").css("background-image", "none");
	//jQuery(".ui-icon").css("text-indent", "0");
	

}


</script>

{% endblock %}

{% block content %}
<table id="list4"></table> 

<div id="pop">
<a href="#" onclick="document.getElementById('pop').style.display='none';">[Fechar]</a>
<br />
	Agora coloque o estilo dessa div.

</div>
{% endblock %}

{% block toolbar %}
<div id="toolbar">
	<div class="centerContainer">
Para os veículos selecionados:<br/>
<input type="button" value="Mostrar no mapa (Google)" onclick="codeLatLng()">
<input type="button" value="Mostrar no mapa (Multispectral)" onclick="mapa_multi()">
	</div> <!-- end centerContainer -->
</div> <!-- end Toolbar -->

{% endblock %}

{% block dialogMap %}
<div id="dialog" title="Rastreamento Veicular">

</div>
{% endblock %}
